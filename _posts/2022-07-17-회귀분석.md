회귀분석은 연속형 종속변수와 1개 이상의 범주형/연속형 독립변수 간 관계를 분석하는 기법이다. 통계학습과 기계학습을 막론하고 가장 기본적이고 핵심적인 분석 방법론 중 하나이다.

# 단순 선형회귀
반응변수 1개, 설명변수 1개

$y=\beta_0+\beta_1x+\varepsilon_i, \varepsilon_i∼ N(0,\sigma^2)$

## 회귀모형의 유의성 검정

모형 유의성은 모형에 포함된 모든 기울기가 0인지 검정하는 분산 분석 문제이다.

단순선형회귀모형은 설명변수가 하나이므로 모형 유의성 검정과 계수 유의성 검정은 동일하다.

$H_0: \beta_1=0  vs  H_1:\beta_1≠0$

## 실습


```python
#데이터 핸들링을 위한 패키지
import numpy as np
import pandas as pd

#통계학습을 위한 패키지
from scipy import stats
import statsmodels.api as sm
from statsmodels.formula.api import ols

#기계학습을 위한 패키지
import sklearn.linear_model
from sklearn.model_selection import train_test_split

#시각화를 위한 패키지
from matplotlib import pyplot as plt
import seaborn as sns

#그래프를 실제로 그리기 위한 설정
%matplotlib inline

#경고 메시지 무시
import warnings 
warnings.filterwarnings('ignore')
```

데이터 불러오기


```python
df=pd.read_csv('C:/exercise/part 03/data/regression/kc_house_data.csv')
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>...</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7129300520</td>
      <td>20141013T000000</td>
      <td>221900.0</td>
      <td>3</td>
      <td>1.00</td>
      <td>1180</td>
      <td>5650</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7</td>
      <td>1180</td>
      <td>0</td>
      <td>1955</td>
      <td>0</td>
      <td>98178</td>
      <td>47.5112</td>
      <td>-122.257</td>
      <td>1340</td>
      <td>5650</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6414100192</td>
      <td>20141209T000000</td>
      <td>538000.0</td>
      <td>3</td>
      <td>2.25</td>
      <td>2570</td>
      <td>7242</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7</td>
      <td>2170</td>
      <td>400</td>
      <td>1951</td>
      <td>1991</td>
      <td>98125</td>
      <td>47.7210</td>
      <td>-122.319</td>
      <td>1690</td>
      <td>7639</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5631500400</td>
      <td>20150225T000000</td>
      <td>180000.0</td>
      <td>2</td>
      <td>1.00</td>
      <td>770</td>
      <td>10000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>6</td>
      <td>770</td>
      <td>0</td>
      <td>1933</td>
      <td>0</td>
      <td>98028</td>
      <td>47.7379</td>
      <td>-122.233</td>
      <td>2720</td>
      <td>8062</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2487200875</td>
      <td>20141209T000000</td>
      <td>604000.0</td>
      <td>4</td>
      <td>3.00</td>
      <td>1960</td>
      <td>5000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7</td>
      <td>1050</td>
      <td>910</td>
      <td>1965</td>
      <td>0</td>
      <td>98136</td>
      <td>47.5208</td>
      <td>-122.393</td>
      <td>1360</td>
      <td>5000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1954400510</td>
      <td>20150218T000000</td>
      <td>510000.0</td>
      <td>3</td>
      <td>2.00</td>
      <td>1680</td>
      <td>8080</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>8</td>
      <td>1680</td>
      <td>0</td>
      <td>1987</td>
      <td>0</td>
      <td>98074</td>
      <td>47.6168</td>
      <td>-122.045</td>
      <td>1800</td>
      <td>7503</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>




```python
df.index+=1 #index를 1로 시작하도록 수정
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>...</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>7129300520</td>
      <td>20141013T000000</td>
      <td>221900.0</td>
      <td>3</td>
      <td>1.00</td>
      <td>1180</td>
      <td>5650</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7</td>
      <td>1180</td>
      <td>0</td>
      <td>1955</td>
      <td>0</td>
      <td>98178</td>
      <td>47.5112</td>
      <td>-122.257</td>
      <td>1340</td>
      <td>5650</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6414100192</td>
      <td>20141209T000000</td>
      <td>538000.0</td>
      <td>3</td>
      <td>2.25</td>
      <td>2570</td>
      <td>7242</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7</td>
      <td>2170</td>
      <td>400</td>
      <td>1951</td>
      <td>1991</td>
      <td>98125</td>
      <td>47.7210</td>
      <td>-122.319</td>
      <td>1690</td>
      <td>7639</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5631500400</td>
      <td>20150225T000000</td>
      <td>180000.0</td>
      <td>2</td>
      <td>1.00</td>
      <td>770</td>
      <td>10000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>6</td>
      <td>770</td>
      <td>0</td>
      <td>1933</td>
      <td>0</td>
      <td>98028</td>
      <td>47.7379</td>
      <td>-122.233</td>
      <td>2720</td>
      <td>8062</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2487200875</td>
      <td>20141209T000000</td>
      <td>604000.0</td>
      <td>4</td>
      <td>3.00</td>
      <td>1960</td>
      <td>5000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7</td>
      <td>1050</td>
      <td>910</td>
      <td>1965</td>
      <td>0</td>
      <td>98136</td>
      <td>47.5208</td>
      <td>-122.393</td>
      <td>1360</td>
      <td>5000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1954400510</td>
      <td>20150218T000000</td>
      <td>510000.0</td>
      <td>3</td>
      <td>2.00</td>
      <td>1680</td>
      <td>8080</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>8</td>
      <td>1680</td>
      <td>0</td>
      <td>1987</td>
      <td>0</td>
      <td>98074</td>
      <td>47.6168</td>
      <td>-122.045</td>
      <td>1800</td>
      <td>7503</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>



결측치 있는지 확인하기


```python
df.isnull().sum()
```




    id               0
    date             0
    price            0
    bedrooms         0
    bathrooms        0
    sqft_living      0
    sqft_lot         0
    floors           0
    waterfront       0
    view             0
    condition        0
    grade            0
    sqft_above       0
    sqft_basement    0
    yr_built         0
    yr_renovated     0
    zipcode          0
    lat              0
    long             0
    sqft_living15    0
    sqft_lot15       0
    dtype: int64



데이터 변수 타입 알아보기


```python
df.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 21613 entries, 1 to 21613
    Data columns (total 21 columns):
     #   Column         Non-Null Count  Dtype  
    ---  ------         --------------  -----  
     0   id             21613 non-null  int64  
     1   date           21613 non-null  object 
     2   price          21613 non-null  float64
     3   bedrooms       21613 non-null  int64  
     4   bathrooms      21613 non-null  float64
     5   sqft_living    21613 non-null  int64  
     6   sqft_lot       21613 non-null  int64  
     7   floors         21613 non-null  float64
     8   waterfront     21613 non-null  int64  
     9   view           21613 non-null  int64  
     10  condition      21613 non-null  int64  
     11  grade          21613 non-null  int64  
     12  sqft_above     21613 non-null  int64  
     13  sqft_basement  21613 non-null  int64  
     14  yr_built       21613 non-null  int64  
     15  yr_renovated   21613 non-null  int64  
     16  zipcode        21613 non-null  int64  
     17  lat            21613 non-null  float64
     18  long           21613 non-null  float64
     19  sqft_living15  21613 non-null  int64  
     20  sqft_lot15     21613 non-null  int64  
    dtypes: float64(5), int64(15), object(1)
    memory usage: 3.5+ MB
    

기본적인 기술 통계값 확인하기


```python
df.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.161300e+04</td>
      <td>2.161300e+04</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>2.161300e+04</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
      <td>21613.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.580302e+09</td>
      <td>5.400881e+05</td>
      <td>3.370842</td>
      <td>2.114757</td>
      <td>2079.899736</td>
      <td>1.510697e+04</td>
      <td>1.494309</td>
      <td>0.007542</td>
      <td>0.234303</td>
      <td>3.409430</td>
      <td>7.656873</td>
      <td>1788.390691</td>
      <td>291.509045</td>
      <td>1971.005136</td>
      <td>84.402258</td>
      <td>98077.939805</td>
      <td>47.560053</td>
      <td>-122.213896</td>
      <td>1986.552492</td>
      <td>12768.455652</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.876566e+09</td>
      <td>3.671272e+05</td>
      <td>0.930062</td>
      <td>0.770163</td>
      <td>918.440897</td>
      <td>4.142051e+04</td>
      <td>0.539989</td>
      <td>0.086517</td>
      <td>0.766318</td>
      <td>0.650743</td>
      <td>1.175459</td>
      <td>828.090978</td>
      <td>442.575043</td>
      <td>29.373411</td>
      <td>401.679240</td>
      <td>53.505026</td>
      <td>0.138564</td>
      <td>0.140828</td>
      <td>685.391304</td>
      <td>27304.179631</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000102e+06</td>
      <td>7.500000e+04</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>290.000000</td>
      <td>5.200000e+02</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>290.000000</td>
      <td>0.000000</td>
      <td>1900.000000</td>
      <td>0.000000</td>
      <td>98001.000000</td>
      <td>47.155900</td>
      <td>-122.519000</td>
      <td>399.000000</td>
      <td>651.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.123049e+09</td>
      <td>3.219500e+05</td>
      <td>3.000000</td>
      <td>1.750000</td>
      <td>1427.000000</td>
      <td>5.040000e+03</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>7.000000</td>
      <td>1190.000000</td>
      <td>0.000000</td>
      <td>1951.000000</td>
      <td>0.000000</td>
      <td>98033.000000</td>
      <td>47.471000</td>
      <td>-122.328000</td>
      <td>1490.000000</td>
      <td>5100.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.904930e+09</td>
      <td>4.500000e+05</td>
      <td>3.000000</td>
      <td>2.250000</td>
      <td>1910.000000</td>
      <td>7.618000e+03</td>
      <td>1.500000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>7.000000</td>
      <td>1560.000000</td>
      <td>0.000000</td>
      <td>1975.000000</td>
      <td>0.000000</td>
      <td>98065.000000</td>
      <td>47.571800</td>
      <td>-122.230000</td>
      <td>1840.000000</td>
      <td>7620.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>7.308900e+09</td>
      <td>6.450000e+05</td>
      <td>4.000000</td>
      <td>2.500000</td>
      <td>2550.000000</td>
      <td>1.068800e+04</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.000000</td>
      <td>8.000000</td>
      <td>2210.000000</td>
      <td>560.000000</td>
      <td>1997.000000</td>
      <td>0.000000</td>
      <td>98118.000000</td>
      <td>47.678000</td>
      <td>-122.125000</td>
      <td>2360.000000</td>
      <td>10083.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>9.900000e+09</td>
      <td>7.700000e+06</td>
      <td>33.000000</td>
      <td>8.000000</td>
      <td>13540.000000</td>
      <td>1.651359e+06</td>
      <td>3.500000</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>13.000000</td>
      <td>9410.000000</td>
      <td>4820.000000</td>
      <td>2015.000000</td>
      <td>2015.000000</td>
      <td>98199.000000</td>
      <td>47.777600</td>
      <td>-121.315000</td>
      <td>6210.000000</td>
      <td>871200.000000</td>
    </tr>
  </tbody>
</table>
</div>




```python
#중간값, 결측치, 왜도, 첨도를 표시한다.

df_stats=df.describe().T #transpose
df_stats

skew_results=[]
kurtosis_results=[] #kurtosis:첨도
null_results=[]
median_results=[]

for idx,val in enumerate(df_stats.index):
    median_results.append(df[val].median())
    skew_results.append(df[val].skew())
    kurtosis_results.append(df[val].kurtosis())
    null_results.append(df[val].isnull().sum())
```


```python
df_stats.index
```




    Index(['id', 'price', 'bedrooms', 'bathrooms', 'sqft_living', 'sqft_lot',
           'floors', 'waterfront', 'view', 'condition', 'grade', 'sqft_above',
           'sqft_basement', 'yr_built', 'yr_renovated', 'zipcode', 'lat', 'long',
           'sqft_living15', 'sqft_lot15'],
          dtype='object')




```python
df.describe().T
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>id</th>
      <td>21613.0</td>
      <td>4.580302e+09</td>
      <td>2.876566e+09</td>
      <td>1.000102e+06</td>
      <td>2.123049e+09</td>
      <td>3.904930e+09</td>
      <td>7.308900e+09</td>
      <td>9.900000e+09</td>
    </tr>
    <tr>
      <th>price</th>
      <td>21613.0</td>
      <td>5.400881e+05</td>
      <td>3.671272e+05</td>
      <td>7.500000e+04</td>
      <td>3.219500e+05</td>
      <td>4.500000e+05</td>
      <td>6.450000e+05</td>
      <td>7.700000e+06</td>
    </tr>
    <tr>
      <th>bedrooms</th>
      <td>21613.0</td>
      <td>3.370842e+00</td>
      <td>9.300618e-01</td>
      <td>0.000000e+00</td>
      <td>3.000000e+00</td>
      <td>3.000000e+00</td>
      <td>4.000000e+00</td>
      <td>3.300000e+01</td>
    </tr>
    <tr>
      <th>bathrooms</th>
      <td>21613.0</td>
      <td>2.114757e+00</td>
      <td>7.701632e-01</td>
      <td>0.000000e+00</td>
      <td>1.750000e+00</td>
      <td>2.250000e+00</td>
      <td>2.500000e+00</td>
      <td>8.000000e+00</td>
    </tr>
    <tr>
      <th>sqft_living</th>
      <td>21613.0</td>
      <td>2.079900e+03</td>
      <td>9.184409e+02</td>
      <td>2.900000e+02</td>
      <td>1.427000e+03</td>
      <td>1.910000e+03</td>
      <td>2.550000e+03</td>
      <td>1.354000e+04</td>
    </tr>
    <tr>
      <th>sqft_lot</th>
      <td>21613.0</td>
      <td>1.510697e+04</td>
      <td>4.142051e+04</td>
      <td>5.200000e+02</td>
      <td>5.040000e+03</td>
      <td>7.618000e+03</td>
      <td>1.068800e+04</td>
      <td>1.651359e+06</td>
    </tr>
    <tr>
      <th>floors</th>
      <td>21613.0</td>
      <td>1.494309e+00</td>
      <td>5.399889e-01</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.500000e+00</td>
      <td>2.000000e+00</td>
      <td>3.500000e+00</td>
    </tr>
    <tr>
      <th>waterfront</th>
      <td>21613.0</td>
      <td>7.541757e-03</td>
      <td>8.651720e-02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>view</th>
      <td>21613.0</td>
      <td>2.343034e-01</td>
      <td>7.663176e-01</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>4.000000e+00</td>
    </tr>
    <tr>
      <th>condition</th>
      <td>21613.0</td>
      <td>3.409430e+00</td>
      <td>6.507430e-01</td>
      <td>1.000000e+00</td>
      <td>3.000000e+00</td>
      <td>3.000000e+00</td>
      <td>4.000000e+00</td>
      <td>5.000000e+00</td>
    </tr>
    <tr>
      <th>grade</th>
      <td>21613.0</td>
      <td>7.656873e+00</td>
      <td>1.175459e+00</td>
      <td>1.000000e+00</td>
      <td>7.000000e+00</td>
      <td>7.000000e+00</td>
      <td>8.000000e+00</td>
      <td>1.300000e+01</td>
    </tr>
    <tr>
      <th>sqft_above</th>
      <td>21613.0</td>
      <td>1.788391e+03</td>
      <td>8.280910e+02</td>
      <td>2.900000e+02</td>
      <td>1.190000e+03</td>
      <td>1.560000e+03</td>
      <td>2.210000e+03</td>
      <td>9.410000e+03</td>
    </tr>
    <tr>
      <th>sqft_basement</th>
      <td>21613.0</td>
      <td>2.915090e+02</td>
      <td>4.425750e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>5.600000e+02</td>
      <td>4.820000e+03</td>
    </tr>
    <tr>
      <th>yr_built</th>
      <td>21613.0</td>
      <td>1.971005e+03</td>
      <td>2.937341e+01</td>
      <td>1.900000e+03</td>
      <td>1.951000e+03</td>
      <td>1.975000e+03</td>
      <td>1.997000e+03</td>
      <td>2.015000e+03</td>
    </tr>
    <tr>
      <th>yr_renovated</th>
      <td>21613.0</td>
      <td>8.440226e+01</td>
      <td>4.016792e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>2.015000e+03</td>
    </tr>
    <tr>
      <th>zipcode</th>
      <td>21613.0</td>
      <td>9.807794e+04</td>
      <td>5.350503e+01</td>
      <td>9.800100e+04</td>
      <td>9.803300e+04</td>
      <td>9.806500e+04</td>
      <td>9.811800e+04</td>
      <td>9.819900e+04</td>
    </tr>
    <tr>
      <th>lat</th>
      <td>21613.0</td>
      <td>4.756005e+01</td>
      <td>1.385637e-01</td>
      <td>4.715590e+01</td>
      <td>4.747100e+01</td>
      <td>4.757180e+01</td>
      <td>4.767800e+01</td>
      <td>4.777760e+01</td>
    </tr>
    <tr>
      <th>long</th>
      <td>21613.0</td>
      <td>-1.222139e+02</td>
      <td>1.408283e-01</td>
      <td>-1.225190e+02</td>
      <td>-1.223280e+02</td>
      <td>-1.222300e+02</td>
      <td>-1.221250e+02</td>
      <td>-1.213150e+02</td>
    </tr>
    <tr>
      <th>sqft_living15</th>
      <td>21613.0</td>
      <td>1.986552e+03</td>
      <td>6.853913e+02</td>
      <td>3.990000e+02</td>
      <td>1.490000e+03</td>
      <td>1.840000e+03</td>
      <td>2.360000e+03</td>
      <td>6.210000e+03</td>
    </tr>
    <tr>
      <th>sqft_lot15</th>
      <td>21613.0</td>
      <td>1.276846e+04</td>
      <td>2.730418e+04</td>
      <td>6.510000e+02</td>
      <td>5.100000e+03</td>
      <td>7.620000e+03</td>
      <td>1.008300e+04</td>
      <td>8.712000e+05</td>
    </tr>
  </tbody>
</table>
</div>




```python
list(enumerate(df_stats.index))
```




    [(0, 'id'),
     (1, 'price'),
     (2, 'bedrooms'),
     (3, 'bathrooms'),
     (4, 'sqft_living'),
     (5, 'sqft_lot'),
     (6, 'floors'),
     (7, 'waterfront'),
     (8, 'view'),
     (9, 'condition'),
     (10, 'grade'),
     (11, 'sqft_above'),
     (12, 'sqft_basement'),
     (13, 'yr_built'),
     (14, 'yr_renovated'),
     (15, 'zipcode'),
     (16, 'lat'),
     (17, 'long'),
     (18, 'sqft_living15'),
     (19, 'sqft_lot15')]



*enumerate(): 순서가 있는 자료형으로 입력받아 인덱스 값을 포함하는 enumerate 객체를 리턴함*


```python
df_stats['median']=median_results
df_stats['missing']=null_results
df_stats['skewness']=skew_results
df_stats['kurtosis']=kurtosis_results
df_stats
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
      <th>median</th>
      <th>missing</th>
      <th>skewness</th>
      <th>kurtosis</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>id</th>
      <td>21613.0</td>
      <td>4.580302e+09</td>
      <td>2.876566e+09</td>
      <td>1.000102e+06</td>
      <td>2.123049e+09</td>
      <td>3.904930e+09</td>
      <td>7.308900e+09</td>
      <td>9.900000e+09</td>
      <td>3.904930e+09</td>
      <td>0</td>
      <td>0.243329</td>
      <td>-1.260542</td>
    </tr>
    <tr>
      <th>price</th>
      <td>21613.0</td>
      <td>5.400881e+05</td>
      <td>3.671272e+05</td>
      <td>7.500000e+04</td>
      <td>3.219500e+05</td>
      <td>4.500000e+05</td>
      <td>6.450000e+05</td>
      <td>7.700000e+06</td>
      <td>4.500000e+05</td>
      <td>0</td>
      <td>4.024069</td>
      <td>34.585540</td>
    </tr>
    <tr>
      <th>bedrooms</th>
      <td>21613.0</td>
      <td>3.370842e+00</td>
      <td>9.300618e-01</td>
      <td>0.000000e+00</td>
      <td>3.000000e+00</td>
      <td>3.000000e+00</td>
      <td>4.000000e+00</td>
      <td>3.300000e+01</td>
      <td>3.000000e+00</td>
      <td>0</td>
      <td>1.974300</td>
      <td>49.063653</td>
    </tr>
    <tr>
      <th>bathrooms</th>
      <td>21613.0</td>
      <td>2.114757e+00</td>
      <td>7.701632e-01</td>
      <td>0.000000e+00</td>
      <td>1.750000e+00</td>
      <td>2.250000e+00</td>
      <td>2.500000e+00</td>
      <td>8.000000e+00</td>
      <td>2.250000e+00</td>
      <td>0</td>
      <td>0.511108</td>
      <td>1.279902</td>
    </tr>
    <tr>
      <th>sqft_living</th>
      <td>21613.0</td>
      <td>2.079900e+03</td>
      <td>9.184409e+02</td>
      <td>2.900000e+02</td>
      <td>1.427000e+03</td>
      <td>1.910000e+03</td>
      <td>2.550000e+03</td>
      <td>1.354000e+04</td>
      <td>1.910000e+03</td>
      <td>0</td>
      <td>1.471555</td>
      <td>5.243093</td>
    </tr>
    <tr>
      <th>sqft_lot</th>
      <td>21613.0</td>
      <td>1.510697e+04</td>
      <td>4.142051e+04</td>
      <td>5.200000e+02</td>
      <td>5.040000e+03</td>
      <td>7.618000e+03</td>
      <td>1.068800e+04</td>
      <td>1.651359e+06</td>
      <td>7.618000e+03</td>
      <td>0</td>
      <td>13.060019</td>
      <td>285.077820</td>
    </tr>
    <tr>
      <th>floors</th>
      <td>21613.0</td>
      <td>1.494309e+00</td>
      <td>5.399889e-01</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.500000e+00</td>
      <td>2.000000e+00</td>
      <td>3.500000e+00</td>
      <td>1.500000e+00</td>
      <td>0</td>
      <td>0.616177</td>
      <td>-0.484723</td>
    </tr>
    <tr>
      <th>waterfront</th>
      <td>21613.0</td>
      <td>7.541757e-03</td>
      <td>8.651720e-02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0</td>
      <td>11.385108</td>
      <td>127.632494</td>
    </tr>
    <tr>
      <th>view</th>
      <td>21613.0</td>
      <td>2.343034e-01</td>
      <td>7.663176e-01</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>4.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0</td>
      <td>3.395750</td>
      <td>10.893022</td>
    </tr>
    <tr>
      <th>condition</th>
      <td>21613.0</td>
      <td>3.409430e+00</td>
      <td>6.507430e-01</td>
      <td>1.000000e+00</td>
      <td>3.000000e+00</td>
      <td>3.000000e+00</td>
      <td>4.000000e+00</td>
      <td>5.000000e+00</td>
      <td>3.000000e+00</td>
      <td>0</td>
      <td>1.032805</td>
      <td>0.525764</td>
    </tr>
    <tr>
      <th>grade</th>
      <td>21613.0</td>
      <td>7.656873e+00</td>
      <td>1.175459e+00</td>
      <td>1.000000e+00</td>
      <td>7.000000e+00</td>
      <td>7.000000e+00</td>
      <td>8.000000e+00</td>
      <td>1.300000e+01</td>
      <td>7.000000e+00</td>
      <td>0</td>
      <td>0.771103</td>
      <td>1.190932</td>
    </tr>
    <tr>
      <th>sqft_above</th>
      <td>21613.0</td>
      <td>1.788391e+03</td>
      <td>8.280910e+02</td>
      <td>2.900000e+02</td>
      <td>1.190000e+03</td>
      <td>1.560000e+03</td>
      <td>2.210000e+03</td>
      <td>9.410000e+03</td>
      <td>1.560000e+03</td>
      <td>0</td>
      <td>1.446664</td>
      <td>3.402304</td>
    </tr>
    <tr>
      <th>sqft_basement</th>
      <td>21613.0</td>
      <td>2.915090e+02</td>
      <td>4.425750e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>5.600000e+02</td>
      <td>4.820000e+03</td>
      <td>0.000000e+00</td>
      <td>0</td>
      <td>1.577965</td>
      <td>2.715574</td>
    </tr>
    <tr>
      <th>yr_built</th>
      <td>21613.0</td>
      <td>1.971005e+03</td>
      <td>2.937341e+01</td>
      <td>1.900000e+03</td>
      <td>1.951000e+03</td>
      <td>1.975000e+03</td>
      <td>1.997000e+03</td>
      <td>2.015000e+03</td>
      <td>1.975000e+03</td>
      <td>0</td>
      <td>-0.469805</td>
      <td>-0.657408</td>
    </tr>
    <tr>
      <th>yr_renovated</th>
      <td>21613.0</td>
      <td>8.440226e+01</td>
      <td>4.016792e+02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>2.015000e+03</td>
      <td>0.000000e+00</td>
      <td>0</td>
      <td>4.549493</td>
      <td>18.701152</td>
    </tr>
    <tr>
      <th>zipcode</th>
      <td>21613.0</td>
      <td>9.807794e+04</td>
      <td>5.350503e+01</td>
      <td>9.800100e+04</td>
      <td>9.803300e+04</td>
      <td>9.806500e+04</td>
      <td>9.811800e+04</td>
      <td>9.819900e+04</td>
      <td>9.806500e+04</td>
      <td>0</td>
      <td>0.405661</td>
      <td>-0.853479</td>
    </tr>
    <tr>
      <th>lat</th>
      <td>21613.0</td>
      <td>4.756005e+01</td>
      <td>1.385637e-01</td>
      <td>4.715590e+01</td>
      <td>4.747100e+01</td>
      <td>4.757180e+01</td>
      <td>4.767800e+01</td>
      <td>4.777760e+01</td>
      <td>4.757180e+01</td>
      <td>0</td>
      <td>-0.485270</td>
      <td>-0.676313</td>
    </tr>
    <tr>
      <th>long</th>
      <td>21613.0</td>
      <td>-1.222139e+02</td>
      <td>1.408283e-01</td>
      <td>-1.225190e+02</td>
      <td>-1.223280e+02</td>
      <td>-1.222300e+02</td>
      <td>-1.221250e+02</td>
      <td>-1.213150e+02</td>
      <td>-1.222300e+02</td>
      <td>0</td>
      <td>0.885053</td>
      <td>1.049501</td>
    </tr>
    <tr>
      <th>sqft_living15</th>
      <td>21613.0</td>
      <td>1.986552e+03</td>
      <td>6.853913e+02</td>
      <td>3.990000e+02</td>
      <td>1.490000e+03</td>
      <td>1.840000e+03</td>
      <td>2.360000e+03</td>
      <td>6.210000e+03</td>
      <td>1.840000e+03</td>
      <td>0</td>
      <td>1.108181</td>
      <td>1.597096</td>
    </tr>
    <tr>
      <th>sqft_lot15</th>
      <td>21613.0</td>
      <td>1.276846e+04</td>
      <td>2.730418e+04</td>
      <td>6.510000e+02</td>
      <td>5.100000e+03</td>
      <td>7.620000e+03</td>
      <td>1.008300e+04</td>
      <td>8.712000e+05</td>
      <td>7.620000e+03</td>
      <td>0</td>
      <td>9.506743</td>
      <td>150.763110</td>
    </tr>
  </tbody>
</table>
</div>



종속변수 price의 왜도(skewnes)가 4.02로 치우쳐 있기 때문에 자연로그를 활용하여 분포를 조정한다.


```python
df['price'].hist()
```




    <AxesSubplot:>




    
![png](output_21_1.png)
    



```python
np.log(df['price']).hist()
```




    <AxesSubplot:>




    
![png](output_22_1.png)
    


변수타입을 살펴보면 date가 object로 되어있어 전처리가 필요한 것을 알 수 있다.(판다스에서 문자열은 object라한다.)


```python
def separate_dtype(df):
    df_obj=df.select_dtypes(include='object')
    df_numr=df.select_dtypes(include=['int64','float64'])
    return[df_obj,df_numr]

(df_obj, df_numr)=separate_dtype(df)
```

*select_dtypes(): 열에 포함된 데이터들을 type 기준으로 인덱싱*


```python
df_obj.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>20141013T000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20141209T000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20150225T000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20141209T000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>20150218T000000</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_obj['date2']=df_obj['date'].apply(lambda x:x[0:4])
df['date2']=df_obj['date2'].astype('int64')
df['date2']
```




    1        2014
    2        2014
    3        2015
    4        2014
    5        2015
             ... 
    21609    2014
    21610    2015
    21611    2014
    21612    2015
    21613    2014
    Name: date2, Length: 21613, dtype: int64



date2(집이 매각된 연도)와 yr_built(지어진 연도)의 기간 차이를 비교해서 sold-build_years라는 새로운 변수를 추가해보자.


```python
df['sold-build_years']=df['date2']-df['yr_built']
df['sold-build_years']
```




    1        59
    2        63
    3        82
    4        49
    5        28
             ..
    21609     5
    21610     1
    21611     5
    21612    11
    21613     6
    Name: sold-build_years, Length: 21613, dtype: int64




```python
df['sold-built_years']=df.apply(lambda x:((x['date2'])-(x['yr_built'])),axis=1)
df['sold-built_years']
```




    1        59
    2        63
    3        82
    4        49
    5        28
             ..
    21609     5
    21610     1
    21611     5
    21612    11
    21613     6
    Name: sold-built_years, Length: 21613, dtype: int64



지금까지 데이터의 전체적인 파악 및 전처리를 했다. 시각화를 통해 데이터의 특징을 알아보자.


```python
df.hist(figsize=(22,18),density=True)
plt.show()
```


    
![png](output_32_0.png)
    


종속변수(price)와 선형관계가 있을 것 같은 독립 변수들을 선정하여 산점도를 그려보자.


```python
df_pairplot=df[['price','bedrooms','sqft_living','waterfront','view','yr_built','sold-built_years','date2']]

sns.pairplot(df_pairplot)
plt.show()
```


    
![png](output_34_0.png)
    


첫번째 줄 3번째칸을 보면 선형관계가 어느정도 보인다. 히트맵(Heatmap)을 통해 종속변수와 상관관계가 높은 독립변수들을 살펴보자.


```python
#fmt=실제값표시 .2f=소수점 둘째 자리

df_corr=df.corr()
cmap=sns.diverging_palette(240,10,n=9,as_cmap=True)

mask=np.zeros_like(df_corr,dtype=np.bool)
mask[np.triu_indices_from(mask)]=True

plt.figure(figsize=(16,12))

sns.heatmap(df.corr(),annot=True,mask=mask,cmap=cmap,linewidths=0.5,fmt='.2f',annot_kws={'size':10})
```




    <AxesSubplot:>




    
![png](output_36_1.png)
    



```python
#price와 상관관계가 높은 독립변수들을 순서대로

df_corr.sort_values(by='price',ascending=False)[['price']]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>price</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>sqft_living</th>
      <td>0.702035</td>
    </tr>
    <tr>
      <th>grade</th>
      <td>0.667434</td>
    </tr>
    <tr>
      <th>sqft_above</th>
      <td>0.605567</td>
    </tr>
    <tr>
      <th>sqft_living15</th>
      <td>0.585379</td>
    </tr>
    <tr>
      <th>bathrooms</th>
      <td>0.525138</td>
    </tr>
    <tr>
      <th>view</th>
      <td>0.397293</td>
    </tr>
    <tr>
      <th>sqft_basement</th>
      <td>0.323816</td>
    </tr>
    <tr>
      <th>bedrooms</th>
      <td>0.308350</td>
    </tr>
    <tr>
      <th>lat</th>
      <td>0.307003</td>
    </tr>
    <tr>
      <th>waterfront</th>
      <td>0.266369</td>
    </tr>
    <tr>
      <th>floors</th>
      <td>0.256794</td>
    </tr>
    <tr>
      <th>yr_renovated</th>
      <td>0.126434</td>
    </tr>
    <tr>
      <th>sqft_lot</th>
      <td>0.089661</td>
    </tr>
    <tr>
      <th>sqft_lot15</th>
      <td>0.082447</td>
    </tr>
    <tr>
      <th>yr_built</th>
      <td>0.054012</td>
    </tr>
    <tr>
      <th>condition</th>
      <td>0.036362</td>
    </tr>
    <tr>
      <th>long</th>
      <td>0.021626</td>
    </tr>
    <tr>
      <th>date2</th>
      <td>0.003576</td>
    </tr>
    <tr>
      <th>id</th>
      <td>-0.016762</td>
    </tr>
    <tr>
      <th>zipcode</th>
      <td>-0.053203</td>
    </tr>
    <tr>
      <th>sold-build_years</th>
      <td>-0.053951</td>
    </tr>
    <tr>
      <th>sold-built_years</th>
      <td>-0.053951</td>
    </tr>
  </tbody>
</table>
</div>



독립변수들 간의 상관관계를 확인해본 결과 sqft_living, sqft_above, sqft_living15 세 변수들이 상관관계가 높이 나왔다. 세 변수들의 데이터 분포들을 보자


```python
living=df[['sqft_living','sqft_living15','sqft_above']]

plt.figure(figsize=(12,6))
ax=sns.distplot(df['sqft_living'], hist=True, norm_hist=False, kde=False, label="sqft_living", color="blue")
ax=sns.distplot(df['sqft_living15'], hist=True, norm_hist=False, kde=False, label="sqft_living15", color="green")
ax=sns.distplot(df['sqft_above'], hist=True, norm_hist=False, kde=False, label="sqft_above", color="red")

ax.set(xlabel="sqft_living/sqft_living15/sqft_above")

plt.legend()
plt.show()
```


    
![png](output_39_0.png)
    


세 변수의 분포가 비슷하다는 것을 볼 수 있다. 따라서 다중공선성이 존재할 경우 이 중 price와 상관관계가 가장 높은 sqft_living으로 분석한다.

설명변수 1개, 반응변수 1개일 때 사용하는 대표적인 방법론으로 단순 선형 회귀분석을 실시한다.


```python
sns.jointplot(x="sqft_living",y="price",data=df,kind='reg')
plt.show()
```


    
![png](output_41_0.png)
    


회귀분석할 때는 항상 상수항을 추가해야한다. add_constant함수를 사용해서 상수항을 추가한다.


```python
X=df[['sqft_living']] #왜 [[]]일까..?
y=df[['price']]

X=sm.add_constant(X,has_constant="add")
X.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>const</th>
      <th>sqft_living</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1180</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>2570</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>770</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1960</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>1680</td>
    </tr>
  </tbody>
</table>
</div>



선형 회귀 모델 적합


```python
model=sm.OLS(y,X)
result_model=model.fit()
result_model.summary()
```




<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>price</td>      <th>  R-squared:         </th>  <td>   0.493</td>  
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.493</td>  
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>2.100e+04</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Sun, 17 Jul 2022</td> <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                 <td>15:25:12</td>     <th>  Log-Likelihood:    </th> <td>-3.0027e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td> 21613</td>      <th>  AIC:               </th>  <td>6.005e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>          <td> 21611</td>      <th>  BIC:               </th>  <td>6.006e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
       <td></td>          <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>       <td>-4.358e+04</td> <td> 4402.690</td> <td>   -9.899</td> <td> 0.000</td> <td>-5.22e+04</td> <td> -3.5e+04</td>
</tr>
<tr>
  <th>sqft_living</th> <td>  280.6236</td> <td>    1.936</td> <td>  144.920</td> <td> 0.000</td> <td>  276.828</td> <td>  284.419</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>14832.490</td> <th>  Durbin-Watson:     </th>  <td>   1.983</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>   <th>  Jarque-Bera (JB):  </th> <td>546444.713</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 2.824</td>   <th>  Prob(JB):          </th>  <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td>26.977</td>   <th>  Cond. No.          </th>  <td>5.63e+03</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 5.63e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.



p-value가 0.05보다 훨씬 작아 귀무가설이 기각된다. 즉, 모형은 통계적으로 유의하다.

# 다중 선형 회귀

단순 선형 회귀모형의 확장으로 연속형 반응변수 하나에 설명변수가 둘 이상인 모형을 말한다. 설명변수가 늘어나므로 추가 검토해야 할 문제는 설명변수의 정보중첩으로 발생하는 **다중공선성**문제와 너무 많은 설명변수를 포함해 발생하는 **고차원의 저주**문제 등이 있다.

$Y=\beta_0+\beta_1X_1+\beta_2X_2+…+\beta_pX_p+\varepsilon, \varepsilon∼^{iid}N(0,\sigma^2)$

## 회귀계수 추정

다중 선형 회귀모형은 최대우도 추정법(Maximum Likelihood Estimation)과 OLS(Ordinary Least Squares)방법 등을 통해 회귀모수를 추정할 수 있다.

## 회귀모형의 유의성 검정

회귀식의 기울기를 통해 단순 선형 회귀모형의 유의미성을 파악할 수 있다. 모형 유의성은 모형에 포함된 모든 기울기가 0인지 검정하는 분산 분석 문제이다. 모형에 대한 유의성 검정은 분산분석과 같이 F-검정을 한다.

$H_0: \beta_1=\beta_2=…=\beta_p=0  vs  H_1:\beta_i가 모두 0은 아니다.$

## 다중공선성(VIF:Variance Inflation Factor)

다중공선성(multicollinearity)란 독립 변수의 일부가 다른 독립 변수의 조합으로 표현될 수 있는 경우이다. 독립 변수들이 서로 독립이 아니라 상호상관관계가 강한 경우에 발생한다.

## 실습


```python
df_reg=df[['price','bedrooms','bathrooms','sqft_living','sqft_lot','floors','waterfront','view','condition','grade','sqft_above','sqft_basement','yr_built','yr_renovated','zipcode','lat','long','sqft_living15','sqft_lot15','date2','sold-built_years']]
```


```python
df_kc_reg=sm.add_constant(df_reg,has_constant="add")
feature_columns=list(df_kc_reg.columns.difference(['price'])) #df_kc_reg 변수명에서 price변수명을 빼라
```


```python
X=df_kc_reg[feature_columns]
y=df_kc_reg.price
```

선형 회귀 모형 적합


```python
multi_linear_model=sm.OLS(y,X)
result_model_1=multi_linear_model.fit()
result_model_1.summary()
```




<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>price</td>      <th>  R-squared:         </th>  <td>   0.701</td>  
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.701</td>  
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>   2816.</td>  
</tr>
<tr>
  <th>Date:</th>             <td>Sun, 17 Jul 2022</td> <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                 <td>15:25:12</td>     <th>  Log-Likelihood:    </th> <td>-2.9455e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td> 21613</td>      <th>  AIC:               </th>  <td>5.891e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>          <td> 21594</td>      <th>  BIC:               </th>  <td>5.893e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>              <td>    18</td>      <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
          <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>bathrooms</th>        <td> 4.125e+04</td> <td> 3245.693</td> <td>   12.710</td> <td> 0.000</td> <td> 3.49e+04</td> <td> 4.76e+04</td>
</tr>
<tr>
  <th>bedrooms</th>         <td>-3.598e+04</td> <td> 1887.302</td> <td>  -19.064</td> <td> 0.000</td> <td>-3.97e+04</td> <td>-3.23e+04</td>
</tr>
<tr>
  <th>condition</th>        <td> 2.767e+04</td> <td> 2348.964</td> <td>   11.781</td> <td> 0.000</td> <td> 2.31e+04</td> <td> 3.23e+04</td>
</tr>
<tr>
  <th>const</th>            <td> -5.46e+07</td> <td> 6.59e+06</td> <td>   -8.282</td> <td> 0.000</td> <td>-6.75e+07</td> <td>-4.17e+07</td>
</tr>
<tr>
  <th>date2</th>            <td> 1.938e+04</td> <td> 1952.650</td> <td>    9.926</td> <td> 0.000</td> <td> 1.56e+04</td> <td> 2.32e+04</td>
</tr>
<tr>
  <th>floors</th>           <td> 7322.7479</td> <td> 3587.535</td> <td>    2.041</td> <td> 0.041</td> <td>  290.915</td> <td> 1.44e+04</td>
</tr>
<tr>
  <th>grade</th>            <td>  9.61e+04</td> <td> 2147.594</td> <td>   44.750</td> <td> 0.000</td> <td> 9.19e+04</td> <td>    1e+05</td>
</tr>
<tr>
  <th>lat</th>              <td> 6.053e+05</td> <td> 1.07e+04</td> <td>   56.511</td> <td> 0.000</td> <td> 5.84e+05</td> <td> 6.26e+05</td>
</tr>
<tr>
  <th>long</th>             <td>-2.147e+05</td> <td> 1.31e+04</td> <td>  -16.387</td> <td> 0.000</td> <td> -2.4e+05</td> <td>-1.89e+05</td>
</tr>
<tr>
  <th>sold-built_years</th> <td>   1.1e+04</td> <td>  976.501</td> <td>   11.265</td> <td> 0.000</td> <td> 9086.327</td> <td> 1.29e+04</td>
</tr>
<tr>
  <th>sqft_above</th>       <td>   70.7676</td> <td>    2.248</td> <td>   31.482</td> <td> 0.000</td> <td>   66.362</td> <td>   75.174</td>
</tr>
<tr>
  <th>sqft_basement</th>    <td>   39.8470</td> <td>    2.640</td> <td>   15.093</td> <td> 0.000</td> <td>   34.672</td> <td>   45.022</td>
</tr>
<tr>
  <th>sqft_living</th>      <td>  110.6141</td> <td>    2.264</td> <td>   48.856</td> <td> 0.000</td> <td>  106.176</td> <td>  115.052</td>
</tr>
<tr>
  <th>sqft_living15</th>    <td>   21.7694</td> <td>    3.439</td> <td>    6.330</td> <td> 0.000</td> <td>   15.028</td> <td>   28.511</td>
</tr>
<tr>
  <th>sqft_lot</th>         <td>    0.1249</td> <td>    0.048</td> <td>    2.612</td> <td> 0.009</td> <td>    0.031</td> <td>    0.219</td>
</tr>
<tr>
  <th>sqft_lot15</th>       <td>   -0.3794</td> <td>    0.073</td> <td>   -5.191</td> <td> 0.000</td> <td>   -0.523</td> <td>   -0.236</td>
</tr>
<tr>
  <th>view</th>             <td> 5.251e+04</td> <td> 2135.068</td> <td>   24.596</td> <td> 0.000</td> <td> 4.83e+04</td> <td> 5.67e+04</td>
</tr>
<tr>
  <th>waterfront</th>       <td> 5.837e+05</td> <td> 1.73e+04</td> <td>   33.705</td> <td> 0.000</td> <td>  5.5e+05</td> <td> 6.18e+05</td>
</tr>
<tr>
  <th>yr_built</th>         <td> 8381.0825</td> <td>  977.490</td> <td>    8.574</td> <td> 0.000</td> <td> 6465.130</td> <td> 1.03e+04</td>
</tr>
<tr>
  <th>yr_renovated</th>     <td>   20.7777</td> <td>    3.648</td> <td>    5.696</td> <td> 0.000</td> <td>   13.628</td> <td>   27.928</td>
</tr>
<tr>
  <th>zipcode</th>          <td> -582.8028</td> <td>   32.905</td> <td>  -17.712</td> <td> 0.000</td> <td> -647.298</td> <td> -518.307</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>18432.447</td> <th>  Durbin-Watson:     </th>  <td>   1.992</td>  
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>   <th>  Jarque-Bera (JB):  </th> <td>1903378.131</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 3.576</td>   <th>  Prob(JB):          </th>  <td>    0.00</td>  
</tr>
<tr>
  <th>Kurtosis:</th>       <td>48.414</td>   <th>  Cond. No.          </th>  <td>6.10e+17</td>  
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The smallest eigenvalue is 5.89e-22. This might indicate that there are<br/>strong multicollinearity problems or that the design matrix is singular.



결과를 보면 모든 변수들의 p-value가 0.05보다 작으므로 모형의 통계적 유의성을 확인할 수 있다.

다중선형회귀분석에서는 모든 변수의 경우 다중공선성의 문제를 확인해야한다.


```python
from statsmodels.stats.outliers_influence import variance_inflation_factor

df_vif=pd.DataFrame()
df_vif["VIF"]=np.round([variance_inflation_factor(df_reg.values,i) for i in range (df_reg.shape[1])],2) #vif계산
df_vif["feature"]=df_reg.columns
df_vif.sort_values(by='VIF',ascending=False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VIF</th>
      <th>feature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>inf</td>
      <td>sqft_above</td>
    </tr>
    <tr>
      <th>11</th>
      <td>inf</td>
      <td>sqft_basement</td>
    </tr>
    <tr>
      <th>19</th>
      <td>inf</td>
      <td>date2</td>
    </tr>
    <tr>
      <th>12</th>
      <td>inf</td>
      <td>yr_built</td>
    </tr>
    <tr>
      <th>20</th>
      <td>inf</td>
      <td>sold-built_years</td>
    </tr>
    <tr>
      <th>3</th>
      <td>inf</td>
      <td>sqft_living</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4922845.94</td>
      <td>zipcode</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1388182.32</td>
      <td>long</td>
    </tr>
    <tr>
      <th>15</th>
      <td>159610.79</td>
      <td>lat</td>
    </tr>
    <tr>
      <th>9</th>
      <td>162.17</td>
      <td>grade</td>
    </tr>
    <tr>
      <th>8</th>
      <td>35.37</td>
      <td>condition</td>
    </tr>
    <tr>
      <th>2</th>
      <td>28.83</td>
      <td>bathrooms</td>
    </tr>
    <tr>
      <th>17</th>
      <td>27.87</td>
      <td>sqft_living15</td>
    </tr>
    <tr>
      <th>1</th>
      <td>23.75</td>
      <td>bedrooms</td>
    </tr>
    <tr>
      <th>5</th>
      <td>17.36</td>
      <td>floors</td>
    </tr>
    <tr>
      <th>0</th>
      <td>10.56</td>
      <td>price</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2.61</td>
      <td>sqft_lot15</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.38</td>
      <td>sqft_lot</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.61</td>
      <td>view</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.28</td>
      <td>waterfront</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1.20</td>
      <td>yr_renovated</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_reg
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>...</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
      <th>date2</th>
      <th>sold-built_years</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>221900.0</td>
      <td>3</td>
      <td>1.00</td>
      <td>1180</td>
      <td>5650</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>...</td>
      <td>0</td>
      <td>1955</td>
      <td>0</td>
      <td>98178</td>
      <td>47.5112</td>
      <td>-122.257</td>
      <td>1340</td>
      <td>5650</td>
      <td>2014</td>
      <td>59</td>
    </tr>
    <tr>
      <th>2</th>
      <td>538000.0</td>
      <td>3</td>
      <td>2.25</td>
      <td>2570</td>
      <td>7242</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>...</td>
      <td>400</td>
      <td>1951</td>
      <td>1991</td>
      <td>98125</td>
      <td>47.7210</td>
      <td>-122.319</td>
      <td>1690</td>
      <td>7639</td>
      <td>2014</td>
      <td>63</td>
    </tr>
    <tr>
      <th>3</th>
      <td>180000.0</td>
      <td>2</td>
      <td>1.00</td>
      <td>770</td>
      <td>10000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>6</td>
      <td>...</td>
      <td>0</td>
      <td>1933</td>
      <td>0</td>
      <td>98028</td>
      <td>47.7379</td>
      <td>-122.233</td>
      <td>2720</td>
      <td>8062</td>
      <td>2015</td>
      <td>82</td>
    </tr>
    <tr>
      <th>4</th>
      <td>604000.0</td>
      <td>4</td>
      <td>3.00</td>
      <td>1960</td>
      <td>5000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>7</td>
      <td>...</td>
      <td>910</td>
      <td>1965</td>
      <td>0</td>
      <td>98136</td>
      <td>47.5208</td>
      <td>-122.393</td>
      <td>1360</td>
      <td>5000</td>
      <td>2014</td>
      <td>49</td>
    </tr>
    <tr>
      <th>5</th>
      <td>510000.0</td>
      <td>3</td>
      <td>2.00</td>
      <td>1680</td>
      <td>8080</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>1987</td>
      <td>0</td>
      <td>98074</td>
      <td>47.6168</td>
      <td>-122.045</td>
      <td>1800</td>
      <td>7503</td>
      <td>2015</td>
      <td>28</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>21609</th>
      <td>360000.0</td>
      <td>3</td>
      <td>2.50</td>
      <td>1530</td>
      <td>1131</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>2009</td>
      <td>0</td>
      <td>98103</td>
      <td>47.6993</td>
      <td>-122.346</td>
      <td>1530</td>
      <td>1509</td>
      <td>2014</td>
      <td>5</td>
    </tr>
    <tr>
      <th>21610</th>
      <td>400000.0</td>
      <td>4</td>
      <td>2.50</td>
      <td>2310</td>
      <td>5813</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>2014</td>
      <td>0</td>
      <td>98146</td>
      <td>47.5107</td>
      <td>-122.362</td>
      <td>1830</td>
      <td>7200</td>
      <td>2015</td>
      <td>1</td>
    </tr>
    <tr>
      <th>21611</th>
      <td>402101.0</td>
      <td>2</td>
      <td>0.75</td>
      <td>1020</td>
      <td>1350</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>...</td>
      <td>0</td>
      <td>2009</td>
      <td>0</td>
      <td>98144</td>
      <td>47.5944</td>
      <td>-122.299</td>
      <td>1020</td>
      <td>2007</td>
      <td>2014</td>
      <td>5</td>
    </tr>
    <tr>
      <th>21612</th>
      <td>400000.0</td>
      <td>3</td>
      <td>2.50</td>
      <td>1600</td>
      <td>2388</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>2004</td>
      <td>0</td>
      <td>98027</td>
      <td>47.5345</td>
      <td>-122.069</td>
      <td>1410</td>
      <td>1287</td>
      <td>2015</td>
      <td>11</td>
    </tr>
    <tr>
      <th>21613</th>
      <td>325000.0</td>
      <td>2</td>
      <td>0.75</td>
      <td>1020</td>
      <td>1076</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>...</td>
      <td>0</td>
      <td>2008</td>
      <td>0</td>
      <td>98144</td>
      <td>47.5941</td>
      <td>-122.299</td>
      <td>1020</td>
      <td>1357</td>
      <td>2014</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
<p>21613 rows × 21 columns</p>
</div>




```python
df_reg.values
```




    array([[2.21900e+05, 3.00000e+00, 1.00000e+00, ..., 5.65000e+03,
            2.01400e+03, 5.90000e+01],
           [5.38000e+05, 3.00000e+00, 2.25000e+00, ..., 7.63900e+03,
            2.01400e+03, 6.30000e+01],
           [1.80000e+05, 2.00000e+00, 1.00000e+00, ..., 8.06200e+03,
            2.01500e+03, 8.20000e+01],
           ...,
           [4.02101e+05, 2.00000e+00, 7.50000e-01, ..., 2.00700e+03,
            2.01400e+03, 5.00000e+00],
           [4.00000e+05, 3.00000e+00, 2.50000e+00, ..., 1.28700e+03,
            2.01500e+03, 1.10000e+01],
           [3.25000e+05, 2.00000e+00, 7.50000e-01, ..., 1.35700e+03,
            2.01400e+03, 6.00000e+00]])



다중공선성 문제 확인

bedrooms, sqrt_living, waterfront, view, sold-built_years를 선택해서 다중 선형회귀분석을 실시해보자. 또한 반응변수에 자연로그를 취해 비대칭인 데이터의 분포를 완화한 상태에서 회귀분석을 한다.


```python
df_reg=df[['bedrooms','sqft_living','waterfront','view','sold-built_years','price']]

df_kc_reg=sm.add_constant(df_reg,has_constant="add")
feature_columns=list(df_kc_reg.columns.difference(['price']))

X=df_kc_reg[feature_columns]

y=np.log(df_kc_reg.price)

multi_linear_model=sm.OLS(y,X)
result_model_2=multi_linear_model.fit()
result_model_2.summary()
```




<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>price</td>      <th>  R-squared:         </th> <td>   0.529</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.529</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   4852.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Sun, 17 Jul 2022</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>15:25:13</td>     <th>  Log-Likelihood:    </th> <td> -8675.5</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td> 21613</td>      <th>  AIC:               </th> <td>1.736e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td> 21607</td>      <th>  BIC:               </th> <td>1.741e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     5</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
          <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>bedrooms</th>         <td>   -0.0413</td> <td>    0.003</td> <td>  -12.647</td> <td> 0.000</td> <td>   -0.048</td> <td>   -0.035</td>
</tr>
<tr>
  <th>const</th>            <td>   12.1722</td> <td>    0.011</td> <td> 1128.098</td> <td> 0.000</td> <td>   12.151</td> <td>   12.193</td>
</tr>
<tr>
  <th>sold-built_years</th> <td>    0.0025</td> <td> 8.96e-05</td> <td>   27.564</td> <td> 0.000</td> <td>    0.002</td> <td>    0.003</td>
</tr>
<tr>
  <th>sqft_living</th>      <td>    0.0004</td> <td> 3.62e-06</td> <td>  117.929</td> <td> 0.000</td> <td>    0.000</td> <td>    0.000</td>
</tr>
<tr>
  <th>view</th>             <td>    0.0785</td> <td>    0.004</td> <td>   21.269</td> <td> 0.000</td> <td>    0.071</td> <td>    0.086</td>
</tr>
<tr>
  <th>waterfront</th>       <td>    0.2885</td> <td>    0.031</td> <td>    9.285</td> <td> 0.000</td> <td>    0.228</td> <td>    0.349</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>190.066</td> <th>  Durbin-Watson:     </th> <td>   1.956</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td> 215.753</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.183</td>  <th>  Prob(JB):          </th> <td>1.41e-47</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.325</td>  <th>  Cond. No.          </th> <td>2.88e+04</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 2.88e+04. This might indicate that there are<br/>strong multicollinearity or other numerical problems.




```python
df_vif=pd.DataFrame()
df_vif["VIF"]=np.round([variance_inflation_factor(df_reg.values,i) for i in range (df_reg.shape[1])],2) #vif계산
df_vif["feature"]=df_reg.columns
df_vif.sort_values(by='VIF',ascending=False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VIF</th>
      <th>feature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>19.32</td>
      <td>sqft_living</td>
    </tr>
    <tr>
      <th>0</th>
      <td>14.17</td>
      <td>bedrooms</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7.56</td>
      <td>price</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.85</td>
      <td>sold-built_years</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.48</td>
      <td>view</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.24</td>
      <td>waterfront</td>
    </tr>
  </tbody>
</table>
</div>



모든 독립변수의 통계적 유의성이 확인되고 다중공선성 문제가 확실히 줄어들었음을 알 수 있다.

# 회귀모형의 가정진단

회귀모형은 반응변수와 설명변수의 선형관계를 전제로 한다. 또한 오차에 대한 독립성, 정규성, 등분산성을 전제로 한다. 앞서 확인한 모형의 유의성과 계수의 유의성이 확보되었다고 해도 오차에 대한 가정을 만족하지 않으면 다른 대안을 찾아야한다. 각각 가정에 대한 진단방법과 해결방안은 다음과 같이 정리할 수 있다.

|구분    |진단방법                                                  |해결방안                                     |
|--------|----------------------------------------------------------|---------------------------------------------|
|선형성  |산점도, 상관계수                                          | 변수변환, 비선형 모형 적합                  |
|독립성  |Durbin-Watson, ACF, 잔차그래프                            | ARMA와 같은 시계열 모형을 이용하는 것이 좋음|
|정규성  |첨도와 왜도, qqplot, 정규성 검정(shapiro-wild or k-s test)|변수 변환, 새로운 변수 투입, 모형 수정       |
|등분산성|잔차 등분산 그래프, white test등                          | 변수 변환, 가중회귀분석                     |


## 선형성

산점도를 이용해 종속변수와 독립변수가 선형 관계인지 알 수 있다. 만약 선형성을 만족하지 않으면 변수변환을 통해 선형성을 유도할 수도 있다.

## 독립성

관측치가 서로 상관되어있을 때 오차의 독립성 문제가 발생한다. 시간에 따라 관측된 자료의 경우 시점 데이터가 시점 값에 영향을 주기도 한다.표준화잔차가 랜덤하게 분포하지 않고 경향성을 갖는 경우, 잔차의 독립성을 의심해야한다. ACF 그래프에서 0 시차 이후에 신뢰구간을 벗어나는 시차가 존재하는 경우에도 독립성을 의심해봐야한다. 이렇게 독립성이 보장되지 않는 경우 시계열 분석을 사용하는 것이 대표적인 방법이고 그 외에도 회귀모형에 계절성을 반영하는 가변수를 포함하거나 자기상관을 갖는 잔차에 대해서만 시계 모형을 적합하는 2-step 모델링 방법도 대안이 될 수 있다.

## 등분산성

등분산이란 분산이 같다는 것이다. 잔차의 등분산성은 잔차가 특정한 패턴 없이 고르게 분포한다는 의미이다. 오차의 등분산성은 잔차 그래프와 등분산성 검정을 통해 알 수 있다. 잔차 그래프를 동안 추세를 갖지 않고 고르게 분포하는지 살펴볼 수 있고 잔차의 등분산성 검정을 통해 등분산성을 만족하는지 통계적으로 확인할 수 있다. 등분산성 검정의 귀무가설은 "$H_0: 잔차의 분산이 같다.(등분산이다)$" 따라서 유의수준 0.05하에서 귀무가설이 기각될 경우 등분산성에 위배된다는 것(이분 분산)을 의미한다.

## 정규성



오차항의 정규성은 잔차에 대한 Q-Q plot을 이용한 시각적 확인 방법과 정규성 검정을 통한 확인 방법이 있다. Q-Q plot을 이용한 방법은 표준화된 잔차가 Q-Q plot의 직선과 가까우면 정규성 가정을 만족한다고 볼 수있다. 정규성 검정을 이용한 방법은 K-S 통계량, Cramer-von Mises 통계량 등을 이용할 수 있다. 각 검정의 귀무가설은 "$H_0: 잔차의 분포는 정규분포를 따른다$"이고 유의수준 0.05 하에서 p-value가 0.05보다 작으면 잔차는 정규분포를 따르지 않는다.

## 실습

### 정규성 검정 - qqplot


```python
qqplot=sm.qqplot(result_model_2.resid,line="s")
```


    
![png](output_74_0.png)
    


### 정규성 검정 - 잔차 패턴 확인


```python
fitted=result_model_2.predict() 

resid=result_model_2.resid #회귀분석 결과의 잔차
pred=result_model_2.predict(X) #회구분석 결과의 적합값(함수값)
fig=plt.scatter(pred,resid,s=3)

plt.xlabel('Fitted values') 
plt.ylabel('Residual')
```




    Text(0, 0.5, 'Residual')




    
![png](output_76_1.png)
    


### 정규성 검정 - shapiro-wilk test


```python
result_shapiro=stats.shapiro(result_model_2.resid)
print(f'F value: {result_shapiro[0]:.4f} / p-value:{result_shapiro[1]:4f}')

if result_shapiro[1]<0.05:
    print("p-value<0.05입니다.")
```

    F value: 0.9959 / p-value:0.000000
    p-value<0.05입니다.
    

qqpoot, 잔차패턴, 샤피로 위크 검정을 통해 정규성을 만족한다는 것을 확인할 수 있다.

### 독립성 검정 - 잔차 그래프


```python
result_model_2.resid.plot()
plt.show()
```


    
![png](output_81_0.png)
    


### 독립성 검정 - ACF


```python
sm.graphics.tsa.plot_acf(result_model_2.resid)
plt.show()
```


    
![png](output_83_0.png)
    


잔차그래프가 특정 패턴 없이 그려지는 것과 와 ACF가 시점에 의존하지 않는 것을 보아 독립성을 만족하는 것을 있다.

### 등분산성 - 잔차그래프


```python
result_model_2.resid.plot()
plt.show()
```


    
![png](output_86_0.png)
    



```python
sns.displot(result_model_2.resid)
plt.show()
```


    
![png](output_87_0.png)
    


잔차그래프의 분산이 일정한 것과 잔차의 히스토그램을 통해 등분산성 가정을 만족하는 것을 확인할 수 있다.

# 회귀모형의 평가

- MSE(Mean Squared Error)
- $R^2$
- $adjusted R^2$
- AIC
- BIC
- MAPE
- RMSE(Root Mean Square Error)

다양한 평가 지표들이 존재한다. 수리적 해석은 필요할때 돌아와서 다시 하겠다. 자세한 내용은 생략한다.

# 선형 회귀분석의 주의사항

## 질적 설명변수
질적설명변수를 포함한 모형은 dummy variable 또는 indicator variable 형태로 변수를 포함해 모형에 포함하는 절차가 필요하다. 가령 키가 클수록 몸무게가 많이 나간다는 선형관계에 있어 남여의 수치 차이가 있을 것이다. 이러한 경우 성별이라는 범주형 변수를 모형에 포함하고 싶다면 0 또는 1을 갖는 남성여부 또는 여성여부라는 변수를 변수를 생성해야한다. 자세한 내용은 앞으로 공부하겠다.

## 이상치
이상치는 관찰된 데이터의 속성과 많이 동떨어진 데이터를 말한다. 이상치는 모형의 가정을 깨뜨리고 회귀모형에 편향(bias)을 발생시켜 모형의 정도를 낮추는 원인이다. 특히 최소제곱으로 추정된 모형은 이상치에 민감하여 이상치를 제거하는 것이 좋다. 이상치 유형으로 지레점, 영향점, 특이값 등이 존재하며 각각의 영향은 Cook의 거리, Welsh&Kuh의 측도,Hadi의 영향력 측도 등을 통해 확인할 수 있다. 이상치를 제거할 수 없거나 탐색이 어려운 경우 로버스트 회귀모형을 이용해 그 영향력을 감소시킬 수 있다. 이상치 역시 산점도를 통한 탐색이 가능하다. 산점도를 통해 소수의 이상치가 발견된 경우 제거하는 것으로 해결 가능하지만 특정 값들이 뭉쳐서 회귀선을 이탈한 경우 누락된 설명변수가 없는지 확인해야한다.

## 다중공선성
다중공선성이란 설명변수들 간의 상관관계가 있는 것을 말한다. 즉 설명변수들 간 정보의 중첩이 발생하는 것이다. 다중공선성 문제가 심각한 경우 최소제곱으로 추정된 모형이 유일한 해를 갖지 않기 때문에 안정성이 매우 떨어진다.다중 공선성 문제를 해결하는 방법은 크게 3가지가 있다.

첫번째, 산점도 행렬이나 상관분석을 통해 다중공선성 문제가 발생한 설명변수 조합을 찾고 각 조합에서 설명력이 제일 높은 변수만을 남기는 방법이다.

두번째, 주성분분석이나 오토인코더 등의 방법을 통해 각 변수로부터 중첩되지 않는 주요 정보들만 추출하는 방법이다.

세번째, Ridge나 LASSO regression 등을 이용해 모형 자체적으로 다중공선성 문제를 상쇄시키는 방법이다. 물론 LASSO의 경우 변수 모형 적합 단계에서 각 설명변수 가중치 조절을 통해 변수 선택 효과도 가지고 있다.

**참조**

data : https://www.kaggle.com/datasets/harlfoxem/housesalesprediction

문헌 : 파이썬 데이터 과학 통계학습 
    
